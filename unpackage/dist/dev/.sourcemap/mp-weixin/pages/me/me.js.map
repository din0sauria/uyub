{"version":3,"file":"me.js","sources":["pages/me/me.vue","../../../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWUvbWUudnVl"],"sourcesContent":["<template>\n  <view class=\"header\"><image src=\"/static/dinoundertreezoom.png\" mode=\"aspectFill\" class=\"img\"></image> </view>\n  <view class=\"container\">\n    <!-- 用户信息卡片 -->\n    <view class=\"info\">\n      <view class=\"user-info\">\n        <view class=\"avatar-section\" @click=\"uploadAvatar\">\n          <image class=\"avatar\" :src=\"userInfo.avatar\" mode=\"aspectFill\" />\n          <uni-icons type=\"camera\" size=\"24\" color=\"#666\" class=\"camera-icon\" />\n        </view>\n        <view class=\"info-section\">\n          <text class=\"nickname\">{{ userInfo.nickname }}</text>\n          <text class=\"phone\" v-if=\"userInfo.userID\">ID：{{ userInfo.userID }}</text>\n          <text class=\"birthday\" v-if=\"userInfo.birthday\">生日：{{ userInfo.birthday }}</text>\n        </view>\n      </view>\n    </view>\n\n    <!-- 功能入口 -->\n    <view class=\"grid-container\">\n          <view class=\"grid-item\" v-for=\"(item, index) in gridList\" :key=\"index\" @click=\"handleGridClick(item)\">\n            <view class=\"grid-icon\">\n              <uni-icons :type=\"item.icon\" :size=\"30\" :color=\"item.color\" />\n            </view>\n            <text class=\"grid-text\">{{ item.title }}</text>\n          </view>\n        </view>\n\n    <!-- 手机号登录按钮 -->\n    <view class=\"login-section\" v-if=\"!userInfo.userID\">\n      <button \n        type=\"primary\" \n        class=\"login-btn\"\n        open-type=\"getPhoneNumber\" \n        @getphonenumber=\"decryptPhoneNumber\"\n      >\n        快速登录\n      </button>\n    </view>\n    <view class=\"login-section\" v-else>\n      <button \n        type=\"primary\" \n        class=\"login-btn\"\n        @click=\"logout\"\n      >\n        退出登录\n      </button>\n    </view>\n  </view>\n    <tabBar :selectedIndex=\"3\" />\n</template>\n\n<script setup>\nimport { ref, reactive, toRaw } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\nimport tabBar from '/components/tabBar.vue';\n// 在script部分添加宫格数据\nconst gridList = ref([\n  { \n    title: '好友管理', \n    icon: 'personadd',\n    color: '#007AFF',\n    handler: () => navTo('friend-manage')\n  },\n  { \n    title: '发布的活动', \n    icon: 'notification',\n    color: '#4CD964',\n    handler: () => navTo('my-published')\n  },\n  { \n    title: '参与的活动', \n    icon: 'flag',\n    color: '#F0AD4E',\n    handler: () => navTo('my-joined')\n  },\n  { \n    title: '建议反馈', \n    icon: 'help',\n    color: '#DD524D',\n    handler: () => navTo('feedback')\n  },\n  { \n    title: '联系客服', \n    icon: 'phone',\n    color: '#10AEFF',\n    handler: () => navTo('about')\n  }\n]);\n\n// 添加宫格点击处理\nconst handleGridClick = (item) => {\n  if(item.handler) item.handler();\n};\n// 用户信息\nconst userInfo = reactive({\n  avatar: '/static/dinohead.png',\n  nickname: '未登录用户',\n  userID: '',\n  birthday: ''\n});\n// 在页面初始化时读取\nonLoad(() => {\n  const stored = uni.getStorageSync('userInfo');\n  if (stored) {\n    Object.assign(userInfo, stored); // 保持响应式\n  }\n});\n// 上传头像\nconst uploadAvatar = async () => {\n  try {\n    const res = await uni.chooseImage({\n      count: 1,\n      sizeType: ['compressed'],\n      sourceType: ['album', 'camera']\n    });\n    \n    // 这里调用上传接口\n    // const uploadRes = await uni.uploadFile({\n    //   url: '/api/uploadAvatar',\n    //   filePath: res.tempFilePaths[0],\n    //   name: 'avatar'\n    // });\n    \n    // 模拟上传成功\n    userInfo.avatar = res.tempFilePaths[0];\n  } catch (err) {\n    uni.showToast({ title: '上传失败', icon: 'none' });\n  }\n};\n\n// 解密手机号\nconst decryptPhoneNumber = async (e) => {\n  if (e.detail.errMsg !== 'getPhoneNumber:ok') return;\n  \n  try {\n    // 这里调用后端解密接口\n    // const { data } = await uni.request({\n    //   url: '/api/decryptPhone',\n    //   method: 'POST',\n    //   data: {\n    //     encryptedData: e.detail.encryptedData,\n    //     iv: e.detail.iv\n    //   }\n    // });\n    \n    // 模拟解密成功\n    userInfo.userID = '12345678910';\n    userInfo.nickname = 'dinosaur';\n    userInfo.birthday = '2000-01-01';\n    uni.showToast({ title: '登录成功' });\n    saveUserInfo();\n  } catch (err) {\n    uni.showToast({ title: '登录失败', icon: 'none' });\n  }\n};\n// 保存到本地\nconst saveUserInfo = () => {\n  uni.setStorageSync('userInfo', toRaw(userInfo)); // 使用toRaw去除Proxy\n}\nconst logout = () => {\n  userInfo.avatar = '/static/dinohead.png';\n  userInfo.nickname = '未登录用户';\n  userInfo.userID = '';\n  userInfo.birthday = '';\n  uni.removeStorageSync('userInfo');\n};\n// 导航功能\nconst navTo = (path) => {\n  uni.navigateTo({ url: `/pages/me/${path}` });\n};\n\n// 联系客服\nconst contactService = () => {\n  // uni.makePhoneCall({\n  //   phoneNumber: '400-123-4567'\n  // });\n};\n</script>\n\n<style scoped lang=\"scss\">\n.header{\n  width: 100%;\n  height: 400rpx;\n  z-index: -1;\n}\n.img{\n  width: 100%;\n  height: 400rpx;\n}\n.container {\n  position: absolute;\n  left: 5%;\n  top:300rpx;\n  width: 90%;\n}\n.info{\n  background-color: #fff;\n  border-radius: 20rpx;\n  padding: 20rpx;\n  margin-bottom: 20rpx;\n}\n\n.user-info {\n  display: flex;\n  align-items: center;\n  padding: 20rpx 0;\n  .avatar-section {\n    position: relative;\n    margin-right: 40rpx;\n    \n    .avatar {\n      width: 120rpx;\n      height: 120rpx;\n      border-radius: 50%;\n      background-color: #eee;\n    }\n    \n    .camera-icon {\n      position: absolute;\n      right: -8rpx;\n      bottom: -8rpx;\n      background: white;\n      border-radius: 50%;\n      padding: 4rpx;\n    }\n  }\n  \n  .info-section {\n    display: flex;\n    flex-direction: column;\n    \n    .nickname {\n      font-size: 36rpx;\n      font-weight: bold;\n      margin-bottom: 10rpx;\n    }\n    \n    .phone, .birthday {\n      font-size: 24rpx;\n      color: #666;\n      margin-bottom: 6rpx;\n    }\n  }\n}\n.grid-container {\n  display: flex;\n  flex-wrap: wrap;\n  background: #fff;\n  border-radius: 20rpx;\n  padding: 20rpx 0;\n  margin-bottom: 20rpx;\n}\n\n.grid-item {\n  flex: 0 0 33.3333%;\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 30rpx 0;\n  position: relative;\n  \n  &:after {\n    content: '';\n    position: absolute;\n    right: 0;\n    top: 50%;\n    transform: translateY(-50%);\n    width: 1px;\n    height: 60%;\n    background-color: #eee;\n  }\n  \n  &:nth-child(3n):after {\n    display: none;\n  }\n}\n\n.grid-icon {\n  width: 60rpx;\n  height: 60rpx;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-bottom: 15rpx;\n}\n\n.grid-text {\n  font-size: 26rpx;\n  color: #666;\n  text-align: center;\n}\n.login-section {\n  margin: 40rpx 30rpx;\n  \n  .login-btn {\n    border-radius: 50rpx;\n    font-size: 32rpx;\n  }\n}\n\n\n</style>","import MiniProgramPage from 'D:/Users/chenyidong/Downloads/yyub-master/pages/me/me.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","onLoad","uni","toRaw"],"mappings":";;;;;;;;;;;AAuDA,MAAM,SAAS,MAAW;;;;AAE1B,UAAM,WAAWA,cAAAA,IAAI;AAAA,MACnB;AAAA,QACE,OAAO;AAAA,QACP,MAAM;AAAA,QACN,OAAO;AAAA,QACP,SAAS,MAAM,MAAM,eAAe;AAAA,MACrC;AAAA,MACD;AAAA,QACE,OAAO;AAAA,QACP,MAAM;AAAA,QACN,OAAO;AAAA,QACP,SAAS,MAAM,MAAM,cAAc;AAAA,MACpC;AAAA,MACD;AAAA,QACE,OAAO;AAAA,QACP,MAAM;AAAA,QACN,OAAO;AAAA,QACP,SAAS,MAAM,MAAM,WAAW;AAAA,MACjC;AAAA,MACD;AAAA,QACE,OAAO;AAAA,QACP,MAAM;AAAA,QACN,OAAO;AAAA,QACP,SAAS,MAAM,MAAM,UAAU;AAAA,MAChC;AAAA,MACD;AAAA,QACE,OAAO;AAAA,QACP,MAAM;AAAA,QACN,OAAO;AAAA,QACP,SAAS,MAAM,MAAM,OAAO;AAAA,MAC7B;AAAA,IACH,CAAC;AAGD,UAAM,kBAAkB,CAAC,SAAS;AAChC,UAAG,KAAK;AAAS,aAAK,QAAO;AAAA,IAC/B;AAEA,UAAM,WAAWC,cAAAA,SAAS;AAAA,MACxB,QAAQ;AAAA,MACR,UAAU;AAAA,MACV,QAAQ;AAAA,MACR,UAAU;AAAA,IACZ,CAAC;AAEDC,kBAAAA,OAAO,MAAM;AACX,YAAM,SAASC,cAAAA,MAAI,eAAe,UAAU;AAC5C,UAAI,QAAQ;AACV,eAAO,OAAO,UAAU,MAAM;AAAA,MAC/B;AAAA,IACH,CAAC;AAED,UAAM,eAAe,YAAY;AAC/B,UAAI;AACF,cAAM,MAAM,MAAMA,cAAG,MAAC,YAAY;AAAA,UAChC,OAAO;AAAA,UACP,UAAU,CAAC,YAAY;AAAA,UACvB,YAAY,CAAC,SAAS,QAAQ;AAAA,QACpC,CAAK;AAUD,iBAAS,SAAS,IAAI,cAAc,CAAC;AAAA,MACtC,SAAQ,KAAK;AACZA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAM,CAAE;AAAA,MAC9C;AAAA,IACH;AAGA,UAAM,qBAAqB,OAAO,MAAM;AACtC,UAAI,EAAE,OAAO,WAAW;AAAqB;AAE7C,UAAI;AAYF,iBAAS,SAAS;AAClB,iBAAS,WAAW;AACpB,iBAAS,WAAW;AACpBA,sBAAAA,MAAI,UAAU,EAAE,OAAO,OAAQ,CAAA;AAC/B;MACD,SAAQ,KAAK;AACZA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAM,CAAE;AAAA,MAC9C;AAAA,IACH;AAEA,UAAM,eAAe,MAAM;AACzBA,oBAAAA,MAAI,eAAe,YAAYC,cAAAA,MAAM,QAAQ,CAAC;AAAA,IAChD;AACA,UAAM,SAAS,MAAM;AACnB,eAAS,SAAS;AAClB,eAAS,WAAW;AACpB,eAAS,SAAS;AAClB,eAAS,WAAW;AACpBD,0BAAI,kBAAkB,UAAU;AAAA,IAClC;AAEA,UAAM,QAAQ,CAAC,SAAS;AACtBA,oBAAG,MAAC,WAAW,EAAE,KAAK,aAAa,IAAI,GAAE,CAAE;AAAA,IAC7C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzKA,GAAG,WAAW,eAAe;"}