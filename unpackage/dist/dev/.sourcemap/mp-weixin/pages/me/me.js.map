{"version":3,"file":"me.js","sources":["pages/me/me.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWUvbWUudnVl"],"sourcesContent":["<template>\n  <view class=\"container\">\n    <!-- 用户信息卡片 -->\n    <uni-card class=\"info\">\n      <view class=\"user-info\">\n        <view class=\"avatar-section\" @click=\"uploadAvatar\">\n          <image class=\"avatar\" :src=\"userInfo.avatar\" mode=\"aspectFill\" />\n          <uni-icons type=\"camera\" size=\"24\" color=\"#666\" class=\"camera-icon\" />\n        </view>\n        <view class=\"info-section\">\n          <text class=\"nickname\">{{ userInfo.nickname }}</text>\n          <text class=\"phone\" v-if=\"userInfo.phone\">手机号：{{ userInfo.phone }}</text>\n          <text class=\"birthday\" v-if=\"userInfo.birthday\">生日：{{ userInfo.birthday }}</text>\n        </view>\n      </view>\n    </uni-card>\n\n    <!-- 功能入口 -->\n    <uni-list>\n      <uni-list-item title=\"好友管理\" showArrow>\n        <template v-slot:header>\n          <uni-icons type=\"personadd\" size=\"20\" color=\"#007AFF\" />\n        </template>\n      </uni-list-item>\n      <uni-list-item title=\"我发布的活动\" showArrow @click=\"navTo('my-published')\">\n        <template v-slot:header>\n          <uni-icons type=\"notification\" size=\"20\" color=\"#4CD964\" />\n        </template>\n      </uni-list-item>\n      <uni-list-item title=\"我参与的活动\" showArrow @click=\"navTo('my-joined')\">\n        <template v-slot:header>\n          <uni-icons type=\"flag\" size=\"20\" color=\"#F0AD4E\" />\n        </template>\n      </uni-list-item>\n      <uni-list-item title=\"建议反馈\" showArrow @click=\"navTo('feedback')\">\n        <template v-slot:header>\n          <uni-icons type=\"help\" size=\"20\" color=\"#DD524D\" />\n        </template>\n      </uni-list-item>\n      <uni-list-item title=\"联系客服\" showArrow @click=\"contactService\">\n        <template v-slot:header>\n          <uni-icons type=\"phone\" size=\"20\" color=\"#10AEFF\" />\n        </template>\n      </uni-list-item>\n    </uni-list>\n\n    <!-- 手机号登录按钮 -->\n    <view class=\"login-section\" v-if=\"!userInfo.phone\">\n      <button \n        type=\"primary\" \n        class=\"login-btn\"\n        open-type=\"getPhoneNumber\" \n        @getphonenumber=\"decryptPhoneNumber\"\n      >\n        手机号快速登录\n      </button>\n    </view>\r\n    <view class=\"login-section\" v-else>\r\n      <button \r\n        type=\"primary\" \r\n        class=\"login-btn\"\r\n        @click=\"logout\"\r\n      >\r\n        退出登录/切换账号\r\n      </button>\r\n    </view>\n  </view>\r\n    <tabBar :selectedIndex=\"3\" />\n</template>\n\n<script setup>\nimport { ref, reactive, toRaw } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\nimport tabBar from '/components/tabBar.vue';\r\n\n// 用户信息\nconst userInfo = reactive({\n  avatar: '/static/dinohead.png',\n  nickname: '未登录用户',\n  phone: '',\n  birthday: ''\n});\n// 在页面初始化时读取\nonLoad(() => {\n  const stored = uni.getStorageSync('userInfo');\n  if (stored) {\n    Object.assign(userInfo, stored); // 保持响应式\n  }\n});\n// 上传头像\nconst uploadAvatar = async () => {\n  try {\n    const res = await uni.chooseImage({\n      count: 1,\n      sizeType: ['compressed'],\n      sourceType: ['album', 'camera']\n    });\n    \n    // 这里调用上传接口\n    // const uploadRes = await uni.uploadFile({\n    //   url: '/api/uploadAvatar',\n    //   filePath: res.tempFilePaths[0],\n    //   name: 'avatar'\n    // });\n    \n    // 模拟上传成功\n    userInfo.avatar = res.tempFilePaths[0];\n  } catch (err) {\n    uni.showToast({ title: '上传失败', icon: 'none' });\n  }\n};\n\n// 解密手机号\nconst decryptPhoneNumber = async (e) => {\n  if (e.detail.errMsg !== 'getPhoneNumber:ok') return;\n  \n  try {\n    // 这里调用后端解密接口\n    // const { data } = await uni.request({\n    //   url: '/api/decryptPhone',\n    //   method: 'POST',\n    //   data: {\n    //     encryptedData: e.detail.encryptedData,\n    //     iv: e.detail.iv\n    //   }\n    // });\n    \n    // 模拟解密成功\n    userInfo.phone = '12345678910';\r\n    userInfo.nickname = 'dinosaur';\r\n    userInfo.birthday = '2000-01-01';\n    uni.showToast({ title: '登录成功' });\r\n    saveUserInfo();\n  } catch (err) {\n    uni.showToast({ title: '登录失败', icon: 'none' });\n  }\n};\n// 保存到本地\nconst saveUserInfo = () => {\n  uni.setStorageSync('userInfo', toRaw(userInfo)); // 使用toRaw去除Proxy\n}\nconst logout = () => {\r\n  userInfo.avatar = '/static/dinohead.png';\r\n  userInfo.nickname = '未登录用户';\r\n  userInfo.phone = '';\r\n  userInfo.birthday = '';\r\n  uni.removeStorageSync('userInfo');\r\n};\n// 导航功能\nconst navTo = (path) => {\n  uni.navigateTo({ url: `/pages/me/${path}` });\n};\n\n// 联系客服\nconst contactService = () => {\n  // uni.makePhoneCall({\n  //   phoneNumber: '400-123-4567'\n  // });\n};\n</script>\n\n<style scoped lang=\"scss\">\n.container {\n  padding: 30rpx;\n  background-color: #f5f5f5;\n  min-height: 100vh;\n}\r\n\n\n.user-info {\n  display: flex;\n  align-items: center;\n  padding: 20rpx 0;\n  \n  .avatar-section {\n    position: relative;\n    margin-right: 40rpx;\n    \n    .avatar {\n      width: 120rpx;\n      height: 120rpx;\n      border-radius: 50%;\n      background-color: #eee;\n    }\n    \n    .camera-icon {\n      position: absolute;\n      right: -8rpx;\n      bottom: -8rpx;\n      background: white;\n      border-radius: 50%;\n      padding: 4rpx;\n    }\n  }\n  \n  .info-section {\n    display: flex;\n    flex-direction: column;\n    \n    .nickname {\n      font-size: 36rpx;\n      font-weight: bold;\n      margin-bottom: 10rpx;\n    }\n    \n    .phone, .birthday {\n      font-size: 24rpx;\n      color: #666;\n      margin-bottom: 6rpx;\n    }\n  }\n}\n\n.login-section {\n  margin: 40rpx 30rpx;\n  \n  .login-btn {\n    border-radius: 50rpx;\n    font-size: 32rpx;\n  }\n}\n\n::v-deep .uni-list-item__header {\n  margin-right: 16rpx;\n}\n</style>","import MiniProgramPage from 'E:/program/FrontEnd/uni/uyub/pages/me/me.vue'\nwx.createPage(MiniProgramPage)"],"names":["reactive","onLoad","uni","toRaw"],"mappings":";;;;;;;;;;;;;;;;AAyEA,MAAM,SAAS,MAAW;;;;AAG1B,UAAM,WAAWA,cAAAA,SAAS;AAAA,MACxB,QAAQ;AAAA,MACR,UAAU;AAAA,MACV,OAAO;AAAA,MACP,UAAU;AAAA,IACZ,CAAC;AAEDC,kBAAAA,OAAO,MAAM;AACX,YAAM,SAASC,cAAAA,MAAI,eAAe,UAAU;AAC5C,UAAI,QAAQ;AACV,eAAO,OAAO,UAAU,MAAM;AAAA,MAC/B;AAAA,IACH,CAAC;AAED,UAAM,eAAe,YAAY;AAC/B,UAAI;AACF,cAAM,MAAM,MAAMA,cAAG,MAAC,YAAY;AAAA,UAChC,OAAO;AAAA,UACP,UAAU,CAAC,YAAY;AAAA,UACvB,YAAY,CAAC,SAAS,QAAQ;AAAA,QACpC,CAAK;AAUD,iBAAS,SAAS,IAAI,cAAc,CAAC;AAAA,MACtC,SAAQ,KAAK;AACZA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAM,CAAE;AAAA,MAC9C;AAAA,IACH;AAGA,UAAM,qBAAqB,OAAO,MAAM;AACtC,UAAI,EAAE,OAAO,WAAW;AAAqB;AAE7C,UAAI;AAYF,iBAAS,QAAQ;AACjB,iBAAS,WAAW;AACpB,iBAAS,WAAW;AACpBA,sBAAAA,MAAI,UAAU,EAAE,OAAO,OAAQ,CAAA;AAC/B;MACD,SAAQ,KAAK;AACZA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAM,CAAE;AAAA,MAC9C;AAAA,IACH;AAEA,UAAM,eAAe,MAAM;AACzBA,oBAAAA,MAAI,eAAe,YAAYC,cAAAA,MAAM,QAAQ,CAAC;AAAA,IAChD;AACA,UAAM,SAAS,MAAM;AACnB,eAAS,SAAS;AAClB,eAAS,WAAW;AACpB,eAAS,QAAQ;AACjB,eAAS,WAAW;AACpBD,0BAAI,kBAAkB,UAAU;AAAA,IAClC;AAEA,UAAM,QAAQ,CAAC,SAAS;AACtBA,oBAAG,MAAC,WAAW,EAAE,KAAK,aAAa,IAAI,GAAE,CAAE;AAAA,IAC7C;AAGA,UAAM,iBAAiB,MAAM;AAAA,IAI7B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC7JA,GAAG,WAAW,eAAe;"}