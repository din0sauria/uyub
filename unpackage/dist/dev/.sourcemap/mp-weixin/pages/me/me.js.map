{"version":3,"file":"me.js","sources":["pages/me/me.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWUvbWUudnVl"],"sourcesContent":["<template>\r\n  <view class=\"header\">\r\n    <image src=\"/static/dinoundertreezoom.jpg\" mode=\"aspectFill\" class=\"img\"></image>\r\n  </view>\r\n  <view class=\"container\">\r\n    <!-- 用户信息卡片 -->\r\n    <view class=\"info\">\r\n      <view class=\"user-info\">\r\n        <view class=\"avatar-section\" @click=\"uploadAvatar\">\r\n          <image class=\"avatar\" :src=\"userInfo.avatar\" mode=\"aspectFill\" />\r\n          <uni-icons type=\"camera\" size=\"24\" color=\"#666\" class=\"camera-icon\" />\r\n        </view>\r\n        <view class=\"info-section\">\r\n          <text class=\"nickname\">{{ userInfo.nickname }}</text>\r\n          <text class=\"phone\" v-if=\"userInfo.userID\">ID：{{ userInfo.userID }}</text>\r\n          <text class=\"birthday\" v-if=\"userInfo.birthday\">生日：{{ userInfo.birthday }}</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 功能入口 -->\r\n    <view class=\"grid-container\">\r\n      <view class=\"grid-item\" v-for=\"(item, index) in gridList\" :key=\"index\" @click=\"handleGridClick(item)\">\r\n        <view class=\"grid-icon\">\r\n          <uni-icons :type=\"item.icon\" :size=\"30\" :color=\"item.color\" />\r\n        </view>\r\n        <text class=\"grid-text\">{{ item.title }}</text>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 手机号登录按钮 -->\r\n    <view class=\"login-section\" v-if=\"!userInfo.userID\">\r\n      <button type=\"primary\" class=\"login-btn\" @click=\"handleWechatLogin\">\r\n        微信快速登录\r\n      </button>\r\n    </view>\r\n    <view class=\"login-section\" v-else>\r\n      <button type=\"primary\" class=\"login-btn\" @click=\"logout\">\r\n        退出登录\r\n      </button>\r\n    </view>\r\n  </view>\r\n  <tabBar :selectedIndex=\"3\" />\r\n</template>\r\n\r\n<script setup>\r\n  import {\r\n    ref,\r\n    reactive,\r\n    toRaw\r\n  } from 'vue';\r\n  import {\r\n    onShow\r\n  } from '@dcloudio/uni-app';\r\n  import tabBar from '/components/tabBar.vue';\r\n  // 在script部分添加宫格数据\r\n  const gridList = ref([{\r\n      title: '个人信息管理',\r\n      icon: 'person',\r\n      color: '#aa00ff',\r\n      handler: () => {\r\n        if (!userInfo.userID) {\r\n          uni.showToast({\r\n            title: '请先登录',\r\n            icon: 'none'\r\n          });\r\n          return;\r\n        }\r\n        navTo('info-manage')\r\n      }\r\n    },\r\n    {\r\n      title: '好友管理',\r\n      icon: 'staff',\r\n      color: '#007AFF',\r\n      handler: () => {\r\n        if (!userInfo.userID) {\r\n          uni.showToast({\r\n            title: '请先登录',\r\n            icon: 'none'\r\n          });\r\n          return;\r\n        }\r\n        navTo('friend-manage')\r\n      }\r\n    },\r\n    {\r\n      title: '发布的活动',\r\n      icon: 'notification',\r\n      color: '#4CD964',\r\n      handler: () => {\r\n        if (!userInfo.userID) {\r\n          uni.showToast({\r\n            title: '请先登录',\r\n            icon: 'none'\r\n          });\r\n          return;\r\n        }\r\n        navTo('my-published')\r\n      }\r\n    },\r\n    {\r\n      title: '参与的活动',\r\n      icon: 'flag',\r\n      color: '#ff0000',\r\n      handler: () => {\r\n        if (!userInfo.userID) {\r\n          uni.showToast({\r\n            title: '请先登录',\r\n            icon: 'none'\r\n          });\r\n          return;\r\n        }\r\n        navTo('my-joined')\r\n      }\r\n    },\r\n    {\r\n      title: '建议反馈',\r\n      icon: 'help',\r\n      color: '#ff557f',\r\n      handler: () => navTo('feedback')\r\n    },\r\n    {\r\n      title: '关于我们',\r\n      icon: 'info',\r\n      color: '#ffaa00',\r\n      handler: () => navTo('about')\r\n    }\r\n  ]);\r\n\r\n  // 添加宫格点击处理\r\n  const handleGridClick = (item) => {\r\n    if (item.handler) item.handler();\r\n  };\r\n  // 用户信息\r\n  const userInfo = reactive({\r\n    avatar: '/static/dinohead.jpg',\r\n    nickname: '未登录用户',\r\n    userID: '',\r\n    birthday: '',\r\n    token: ''\r\n  });\r\n  // 展示页面时读取本地存储的数据\r\n  onShow(() => {\r\n    const stored = uni.getStorageSync('userInfo');\r\n    if (stored) {\r\n      Object.assign(userInfo, stored); // 保持响应式\r\n    }\r\n  });\r\n  // 上传头像\r\n  const uploadAvatar = async () => {\r\n    try {\r\n      const res = await uni.chooseImage({\r\n        count: 1,\r\n        sizeType: ['compressed'],\r\n        sourceType: ['album', 'camera']\r\n      });\r\n\r\n      // 这里调用上传接口\r\n      // const uploadRes = await uni.uploadFile({\r\n      //   url: '/api/uploadAvatar',\r\n      //   filePath: res.tempFilePaths[0],\r\n      //   name: 'avatar'\r\n      // });\r\n\r\n      // 模拟上传成功\r\n      userInfo.avatar = res.tempFilePaths[0];\r\n    } catch (err) {\r\n      uni.showToast({\r\n        title: '上传失败',\r\n        icon: 'none'\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleWechatLogin = async () => {\r\n    if (userInfo.userID) return;\r\n\r\n    try {\r\n      // 1. 获取微信code\r\n      const loginRes = await uni.login({\r\n        provider: 'weixin'\r\n      });\r\n\r\n      // 2. 发送code到后端\r\n      const {\r\n        code\r\n      } = loginRes;\r\n      //console.log(code);\r\n      // 后端接口\r\n      const {\r\n        data\r\n      } = await uni.request({\r\n        url: 'http://127.0.0.1:4523/m1/5810635-5495696-default/user/login',\r\n        method: 'POST',\r\n        data: {\r\n          code\r\n        }\r\n      });\r\n\r\n      // 3. 登录成功处理\r\n      if (data.data) {\r\n        //uni.showToast({ title: '登录成功' });\r\n        // 保存\r\n        userInfo.token = data.data;\r\n        saveUserInfo();\r\n        getUserInfo();\r\n      } else uni.showToast({\r\n        title: '登录失败',\r\n        icon: 'none'\r\n      });\r\n      //console.log(data);\r\n    } catch (err) {\r\n      uni.showToast({\r\n        title: '登录失败',\r\n        icon: 'none'\r\n      });\r\n      console.log(err);\r\n    }\r\n  };\r\n  const getUserInfo = async () => {\r\n    try {\r\n      // 发送请求获取用户信息\r\n      await uni.request({\r\n        url: 'http://127.0.0.1:4523/m1/5810635-5495696-default/user/info',\r\n        method: 'GET',\r\n        header: {\r\n          Authorization: `${userInfo.token}`\r\n        },\r\n        success: (res) => {\r\n                console.log(res.data.data);\r\n                // 更新用户信息\r\n                if (res.data.data.userID) {\r\n                userInfo.avatar = res.data.data.avatar;\r\n                userInfo.userID = res.data.data.userID;\r\n                userInfo.nickname = res.data.data.nickname;\r\n                userInfo.birthday = res.data.data.birthday;\r\n                saveUserInfo(); \r\n                uni.showToast({ title: '登录成功' });\r\n            }\r\n      }});\r\n    } catch (err) {\r\n      uni.showToast({\r\n        title: '发送请求失败',\r\n        icon: 'none'\r\n      });\r\n      console.log(err);\r\n    }\r\n  };\r\n\r\n  // 保存到本地\r\n  const saveUserInfo = () => {\r\n    uni.setStorageSync('userInfo', toRaw(userInfo)); // 使用toRaw去除Proxy\r\n  }\r\n  const logout = () => {\r\n    userInfo.avatar = '/static/dinohead.jpg';\r\n    userInfo.nickname = '未登录用户';\r\n    userInfo.userID = '';\r\n    userInfo.birthday = '';\r\n    userInfo.token = '';\r\n    uni.removeStorageSync('userInfo');\r\n  };\r\n  // 导航功能\r\n  const navTo = (path) => {\r\n    uni.navigateTo({\r\n      url: `/pages/me/${path}`\r\n    });\r\n  };\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n  .header {\r\n    width: 100%;\r\n    height: 400rpx;\r\n    z-index: -1;\r\n  }\r\n\r\n  .img {\r\n    width: 100%;\r\n    height: 400rpx;\r\n  }\r\n\r\n  .container {\r\n    position: absolute;\r\n    left: 5%;\r\n    top: 300rpx;\r\n    width: 90%;\r\n  }\r\n\r\n  .info {\r\n    background-color: #fff;\r\n    border-radius: 20rpx;\r\n    padding: 20rpx;\r\n    margin-bottom: 20rpx;\r\n  }\r\n\r\n  .user-info {\r\n    display: flex;\r\n    align-items: center;\r\n    padding: 20rpx 0;\r\n\r\n    .avatar-section {\r\n      position: relative;\r\n      margin-right: 40rpx;\r\n\r\n      .avatar {\r\n        width: 120rpx;\r\n        height: 120rpx;\r\n        border-radius: 50%;\r\n        background-color: #eee;\r\n      }\r\n\r\n      .camera-icon {\r\n        position: absolute;\r\n        right: -8rpx;\r\n        bottom: -8rpx;\r\n        background: white;\r\n        border-radius: 50%;\r\n        padding: 4rpx;\r\n      }\r\n    }\r\n\r\n    .info-section {\r\n      display: flex;\r\n      flex-direction: column;\r\n\r\n      .nickname {\r\n        font-size: 36rpx;\r\n        font-weight: bold;\r\n        margin-bottom: 10rpx;\r\n      }\r\n\r\n      .phone,\r\n      .birthday {\r\n        font-size: 24rpx;\r\n        color: #666;\r\n        margin-bottom: 6rpx;\r\n      }\r\n    }\r\n  }\r\n\r\n  .grid-container {\r\n    display: flex;\r\n    flex-wrap: wrap;\r\n    background: #fff;\r\n    border-radius: 20rpx;\r\n    padding: 20rpx 0;\r\n    margin-bottom: 20rpx;\r\n  }\r\n\r\n  .grid-item {\r\n    flex: 0 0 33.3333%;\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    justify-content: center;\r\n    padding: 30rpx 0;\r\n    position: relative;\r\n\r\n    &:after {\r\n      content: '';\r\n      position: absolute;\r\n      right: 0;\r\n      top: 50%;\r\n      transform: translateY(-50%);\r\n      width: 1px;\r\n      height: 60%;\r\n      background-color: #eee;\r\n    }\r\n\r\n    &:nth-child(3n):after {\r\n      display: none;\r\n    }\r\n  }\r\n\r\n  .grid-icon {\r\n    width: 60rpx;\r\n    height: 60rpx;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    margin-bottom: 15rpx;\r\n  }\r\n\r\n  .grid-text {\r\n    font-size: 26rpx;\r\n    color: #666;\r\n    text-align: center;\r\n  }\r\n\r\n  .login-section {\r\n    margin: 40rpx 30rpx;\r\n\r\n    .login-btn {\r\n      border-radius: 50rpx;\r\n      font-size: 32rpx;\r\n    }\r\n  }\r\n</style>","import MiniProgramPage from 'E:/program/FrontEnd/uni/uyub/pages/me/me.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","uni","reactive","onShow","toRaw"],"mappings":"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"}