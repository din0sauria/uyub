{"version":3,"file":"chat-window.js","sources":["pages/message/chat-window.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVzc2FnZS9jaGF0LXdpbmRvdy52dWU"],"sourcesContent":["<template>\n\t<view class=\"chat-container\">\n\t\t<!-- 标题栏 -->\n\t\t<view class=\"header\" :style=\"{ paddingTop: safeAreaInsets?.top + 'px' }\">\n\t\t\t<view class=\"nav-back\" @click=\"goBack\">\n\t\t\t\t<uni-icons type=\"left\" size=\"24\" color=\"#333\"></uni-icons>\n\t\t\t\t<text class=\"friend-name\">{{ friendInfo.nickname }}</text>\n\t\t\t</view>\n\t\t</view>\n\n\t\t<!-- 消息列表 -->\n\t\t<scroll-view \n\t\t\tclass=\"message-area\" \n\t\t\tscroll-y\n\t\t\t:scroll-with-animation=\"true\"\n\t\t\t:scroll-top=\"scrollTop\"\n\t\t>\n\t\t\t<view \n\t\t\t\tv-for=\"(msg, index) in messages\" \n\t\t\t\t:key=\"index\" \n\t\t\t\tclass=\"message-bubble\"\n\t\t\t\t:class=\"{ 'self-message': msg.isSelf }\"\n\t\t\t>\n\t\t\t\t<image \n\t\t\t\t\tclass=\"user-avatar\"\n\t\t\t\t\t:src=\"msg.isSelf ? myInfo.avatar : friendInfo.avatar\"\n\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t/>\n\t\t\t\t<view class=\"content-box\">\n\t\t\t\t\t<text class=\"message-text\">{{ msg.content }}</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t<view class=\"scroll-anchor\"></view>\n\t\t</scroll-view>\n\n\t\t<!-- 输入框 -->\n\t\t<view class=\"input-area\" :style=\"{ paddingBottom: safeAreaInsets?.bottom + 'px' }\">\n\t\t\t<textarea\n\t\t\t\tclass=\"message-input\"\n\t\t\t\tv-model=\"messageToSend\"\n\t\t\t\tplaceholder=\"输入消息...\"\n\t\t\t\t:adjust-position=\"false\"\n\t\t\t\t@confirm=\"sendMessage\"\n\t\t\t/>\n\t\t\t<button \n\t\t\t\tclass=\"send-button\" \n\t\t\t\t:class=\"{ 'disabled': !messageToSend.trim() }\" \n\t\t\t\t@click=\"sendMessage\"\n\t\t\t>\n\t\t\t\t发送\n\t\t\t</button>\n\t\t</view>\n\t</view>\n</template>\n\n<script setup>\nimport { ref, reactive, nextTick } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\n\nconst { safeAreaInsets } = uni.getSystemInfoSync();\n\n// 用户信息\nconst myInfo = reactive({\n\tavatar: '/static/pyy.jpeg',\n\tnickname: '未登录用户',\n\tuserID: '8'\n});\n\nconst friendInfo = reactive({\n\tavatar: '',\n\tnickname: '',\n\tuserID: ''\n});\n\n// 消息相关\nconst messages = ref([]);\nconst messageToSend = ref('');\nconst scrollTop = ref(0);\n\n// 初始化加载\nonLoad((options) => {\n\tconst stored = uni.getStorageSync('userInfo');\n\tif (stored) Object.assign(myInfo, stored);\n\t\n\tfriendInfo.avatar = options.friendAvatar || '/static/default-avatar.png';\n\tfriendInfo.nickname = options.friendName || '未命名用户';\n\tfriendInfo.userID = options.friendId;\n\t\n\tloadHistoryMessages(options.friendId, myInfo.userID);\n});\n\n// 加载历史消息\nconst loadHistoryMessages = (friendId, myId) => {\n\ttry {\n\t\tconst chatHistory = chatRecords[myId]?.[friendId] || [];\n\t\tmessages.value = chatHistory.map(msg => ({\n\t\t\tcontent: msg.content,\n\t\t\tisSelf: msg.senderId === myId\n\t\t}));\n\t\tscrollToBottom();\n\t} catch (error) {\n\t\tconsole.error(\"加载历史消息失败:\", error);\n\t}\n};\n\n// 发送消息\nconst sendMessage = () => {\n\tconst content = messageToSend.value.trim();\n\tif (!content) return;\n\n\tmessages.value.push({\n\t\tcontent: content,\n\t\tisSelf: true\n\t});\n\t\n\tmessageToSend.value = '';\n\tscrollToBottom();\n};\n\n// 滚动到底部\nconst scrollToBottom = () => {\n\tnextTick(() => {\n\t\tscrollTop.value = Math.random();\n\t});\n};\n\nconst goBack = () => {\n\tuni.navigateBack();\n};\n\n// 模拟数据\nconst chatRecords = {\n\"8\": { // 用户1的聊天记录\n\t\t\t\"1\": [ // 与用户2的聊天记录\n\t\t\t\t{\n\t\t\t\t\tsenderId: \"1\",\n\t\t\t\t\tcontent: \"你好！\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tsenderId: \"8\",\n\t\t\t\t\tcontent: \"你好，我是彭于晏\",\t\t\n\t\t\t\t}\n\t\t\t],\n\t\t\t\"3\": [ // 与用户3的聊天记录\n\t\t\t\t{\n\t\t\t\t\tsenderId: \"1\",\n\t\t\t\t\tcontent: \"嗨，最近怎么样？\",\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t\"2\": { // 用户2的聊天记录\n\t\t\t\"1\": [ // 与用户1的聊天记录（与上面重复，但为了完整性保留）\n\t\t\t\t{\n\t\t\t\t\tsenderId: \"1\",\n\t\t\t\t\tcontent: \"你好！\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tsenderId: \"2\",\n\t\t\t\t\tcontent: \"你好，我是朋友\",\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t\"3\": { // 用户3的聊天记录\n\t\t\t\"1\": [ // 与用户1的聊天记录\n\t\t\t\t{\n\t\t\t\t\tsenderId: \"1\",\n\t\t\t\t\tcontent: \"嗨，最近怎么样？\",\n\t\t\t\t}\n\t\t\t]\n\t\t}\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.chat-container {\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100vh;\n\tbackground: #f0f2f5;\n\n\t.header {\n\t\tbackground: #fff;\r\n    height: 100rpx;\n\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\r\n    display: flex;\r\n    align-items: center;\n\t\t.nav-back {\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tpadding: 16rpx 24rpx;\n\t\t\t\n\t\t\t.friend-name {\r\n        margin-left: 16rpx;\n\t\t\t\tfont-size: 34rpx;\n\t\t\t\tfont-weight: 500;\n\t\t\t\tcolor: #333;\n\t\t\t}\n\t\t}\n\t}\n\n\t.message-area {\n\t\tflex: 1;\n\t\toverflow-anchor: auto;\n\n\t\t.message-bubble {\n\t\t\tmargin: 24rpx 20rpx;\n\t\t\tdisplay: flex;\n\t\t\talign-items: flex-start;\n\t\t\tmax-width: 80%;\n\n\t\t\t.user-avatar {\n\t\t\t\tflex-shrink: 0;\n\t\t\t\twidth: 64rpx;\n\t\t\t\theight: 64rpx;\n\t\t\t\tborder-radius: 8rpx;\n\t\t\t\tmargin-right: 16rpx;\n\t\t\t}\n\n\t\t\t.content-box {\n\t\t\t\tpadding: 16rpx 24rpx;\n\t\t\t\tbackground: #fff;\n\t\t\t\tborder-radius: 12rpx;\n\t\t\t\tbox-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.08);\n\t\t\t\t.message-text {\n\t\t\t\t\tfont-size: 30rpx;\n\t\t\t\t\tline-height: 1.4;\n\t\t\t\t\tcolor: #333;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t&.self-message {\n\t\t\t\tflex-direction: row-reverse;\n\t\t\t\tmargin-left: auto;\n\t\t\t\t\n\t\t\t\t.user-avatar {\n\t\t\t\t\tmargin-left: 16rpx;\n\t\t\t\t\tmargin-right: 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t.content-box {\n\t\t\t\t\tbackground: #07c160;\n\t\t\t\t\t.message-text {\n\t\t\t\t\t\tcolor: #fff;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t.scroll-anchor {\n\t\t\theight: 1rpx;\n\t\t\tvisibility: hidden;\n\t\t}\n\t}\n\n\t.input-area {\n\t\tbackground: #fff;\n\t\tpadding: 20rpx 24rpx;\n\t\tdisplay: flex;\n\t\talign-items: center;\n\t\tborder-top: 1rpx solid #eee;\n\t\tbox-shadow: 0 -4rpx 12rpx rgba(0, 0, 0, 0.03);\n\n\t\t.message-input {\n\t\t\tflex: 1;\n\t\t\tmin-height: 80rpx;\n\t\t\tmax-height: 200rpx;\n\t\t\tpadding: 16rpx 24rpx;\n\t\t\tmargin-right: 20rpx;\n\t\t\tbackground: #f8f8f8;\n\t\t\tborder-radius: 40rpx;\n\t\t\tfont-size: 30rpx;\n\t\t\tline-height: 1.4;\n\t\t}\n\n\t\t.send-button {\n\t\t\twidth: 140rpx;\n\t\t\theight: 80rpx;\n\t\t\tline-height: 80rpx;\n\t\t\tbackground: #07c160;\n\t\t\tcolor: #fff;\n\t\t\tfont-size: 30rpx;\n\t\t\tborder-radius: 40rpx;\n\t\t\ttransition: all 0.2s;\n\n\t\t\t&.disabled {\n\t\t\t\tbackground: #ccc;\n\t\t\t\topacity: 0.7;\n\t\t\t}\n\t\t}\n\t}\n}\n</style>","import MiniProgramPage from 'E:/program/FrontEnd/uni/uyub/pages/message/chat-window.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","reactive","ref","onLoad","nextTick"],"mappings":";;;;;;;;;;;;;AA2DA,UAAM,EAAE,eAAgB,IAAGA,oBAAI;AAG/B,UAAM,SAASC,cAAAA,SAAS;AAAA,MACvB,QAAQ;AAAA,MACR,UAAU;AAAA,MACV,QAAQ;AAAA,IACT,CAAC;AAED,UAAM,aAAaA,cAAAA,SAAS;AAAA,MAC3B,QAAQ;AAAA,MACR,UAAU;AAAA,MACV,QAAQ;AAAA,IACT,CAAC;AAGD,UAAM,WAAWC,cAAAA,IAAI,CAAA,CAAE;AACvB,UAAM,gBAAgBA,cAAAA,IAAI,EAAE;AAC5B,UAAM,YAAYA,cAAAA,IAAI,CAAC;AAGvBC,kBAAM,OAAC,CAAC,YAAY;AACnB,YAAM,SAASH,cAAAA,MAAI,eAAe,UAAU;AAC5C,UAAI;AAAQ,eAAO,OAAO,QAAQ,MAAM;AAExC,iBAAW,SAAS,QAAQ,gBAAgB;AAC5C,iBAAW,WAAW,QAAQ,cAAc;AAC5C,iBAAW,SAAS,QAAQ;AAE5B,0BAAoB,QAAQ,UAAU,OAAO,MAAM;AAAA,IACpD,CAAC;AAGD,UAAM,sBAAsB,CAAC,UAAU,SAAS;;AAC/C,UAAI;AACH,cAAM,gBAAc,iBAAY,IAAI,MAAhB,mBAAoB,cAAa,CAAA;AACrD,iBAAS,QAAQ,YAAY,IAAI,UAAQ;AAAA,UACxC,SAAS,IAAI;AAAA,UACb,QAAQ,IAAI,aAAa;AAAA,QACzB,EAAC;AACF;MACA,SAAQ,OAAO;AACfA,mFAAc,aAAa,KAAK;AAAA,MAChC;AAAA,IACF;AAGA,UAAM,cAAc,MAAM;AACzB,YAAM,UAAU,cAAc,MAAM,KAAI;AACxC,UAAI,CAAC;AAAS;AAEd,eAAS,MAAM,KAAK;AAAA,QACnB;AAAA,QACA,QAAQ;AAAA,MACV,CAAE;AAED,oBAAc,QAAQ;AACtB;IACD;AAGA,UAAM,iBAAiB,MAAM;AAC5BI,oBAAAA,WAAS,MAAM;AACd,kBAAU,QAAQ,KAAK;MACzB,CAAE;AAAA,IACF;AAEA,UAAM,SAAS,MAAM;AACpBJ,oBAAG,MAAC,aAAY;AAAA,IACjB;AAGA,UAAM,cAAc;AAAA,MACpB,KAAK;AAAA;AAAA,QACF,KAAK;AAAA;AAAA,UACJ;AAAA,YACC,UAAU;AAAA,YACV,SAAS;AAAA,UACT;AAAA,UACD;AAAA,YACC,UAAU;AAAA,YACV,SAAS;AAAA,UACT;AAAA,QACD;AAAA,QACD,KAAK;AAAA;AAAA,UACJ;AAAA,YACC,UAAU;AAAA,YACV,SAAS;AAAA,UACT;AAAA,QACD;AAAA,MACD;AAAA,MACD,KAAK;AAAA;AAAA,QACJ,KAAK;AAAA;AAAA,UACJ;AAAA,YACC,UAAU;AAAA,YACV,SAAS;AAAA,UACT;AAAA,UACD;AAAA,YACC,UAAU;AAAA,YACV,SAAS;AAAA,UACT;AAAA,QACD;AAAA,MACD;AAAA,MACD,KAAK;AAAA;AAAA,QACJ,KAAK;AAAA;AAAA,UACJ;AAAA,YACC,UAAU;AAAA,YACV,SAAS;AAAA,UACT;AAAA,QACD;AAAA,MACD;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzKA,GAAG,WAAW,eAAe;"}