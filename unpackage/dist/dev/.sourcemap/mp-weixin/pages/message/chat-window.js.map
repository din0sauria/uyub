{"version":3,"file":"chat-window.js","sources":["pages/message/chat-window.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbWVzc2FnZS9jaGF0LXdpbmRvdy52dWU"],"sourcesContent":["<template>\r\n\t<view class=\"chat-window\">\r\n\t\t<!-- 标题栏 -->\r\n\t\t<view class=\"header\" :style=\"{paddingTop:safeAreaInsets?.top + 'px'}\">\r\n\t\t\t<view class=\"icon-back\" @click=\"goBack\">\r\n\t\t\t\t<uni-icons type=\"left\" size=\"24\" color=\"gray\"></uni-icons>\r\n\t\t\t</view>\r\n\t\t\t<text class=\"friend-name\">{{ friendInfo.nickname }}</text>\r\n\t\t</view>\r\n\r\n\t\t<!-- 消息列表 -->\r\n\t\t<scroll-view class=\"message-list\" scroll-y>\r\n\t\t\t<view v-for=\"(msg, index) in messages\" :key=\"msg.id\" class=\"message-item\">\r\n\t\t\t\t<!-- 对方消息 -->\r\n\t\t\t\t<view v-if=\"!msg.isSelf\" class=\"message-friend\">\r\n\t\t\t\t\t<image class=\"avatar-friend\" :src=\"friendInfo.avatar\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t<view class=\"message-content-friend-text\">\r\n\t\t\t\t\t\t{{msg.content}}\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\r\n\r\n\t\t\t\t<!-- 自己消息 -->\r\n\t\t\t\t<view v-else class=\"message-self\">\r\n\t\t\t\t\t<image class=\"avatar-self\" :src=\"myInfo.avatar\" mode=\"aspectFill\"></image>\r\n\t\t\t\t\t<view class=\"message-content-self-text\">{{msg.content}}</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- 占位元素，用于滚动到底部 -->\r\n\t\t\t<view id=\"last-msg-item\" style=\"height: 1px;\"></view>\r\n\t\t</scroll-view>\r\n\r\n\t\t<!-- 输入框 -->\r\n\t\t<view class=\"input-container\">\r\n\t\t\t<textarea class=\"input-box\" v-model=\"messageToSend\" placeholder=\"请输入内容\" @focus=\"onFocus\" @blur=\"onBlur\"\r\n\t\t\t\t@confirm=\"onComfirm\"></textarea>\r\n\t\t\t<button class=\"send\" v-if=\"toggle\" @click=\"onComfirm\">\r\n\t\t\t\t发送\r\n\t\t\t</button>\r\n\t\t\t<template v-else>\r\n\t\t\t\t<uni-icons class=\"emoji\" type=\"fire\" size=\"30\"></uni-icons>\r\n\t\t\t\t<uni-icons class=\"more\" type=\"plus\" size=\"30\"></uni-icons>\r\n\t\t\t</template>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script setup>\r\n\timport {\r\n\t\tref,\n\t\treactive,\r\n\t} from 'vue';\r\n\r\n\timport {\r\n\t\tonLoad\r\n\t} from '@dcloudio/uni-app';\r\n\r\n\tconst {\r\n\t\tsafeAreaInsets\r\n\t} = uni.getSystemInfoSync();\r\n\t\r\n\t// 临时数据——聊天记录数据\r\n\tconst chatRecords = {\r\n\t\t\"8\": { // 用户1的聊天记录\r\n\t\t\t\"1\": [ // 与用户2的聊天记录\r\n\t\t\t\t{\r\n\t\t\t\t\tsenderId: \"1\",\r\n\t\t\t\t\tcontent: \"你好！\",\r\n\t\t\t\t\ttime: \"2025-02-18T10:00:00\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tsenderId: \"8\",\r\n\t\t\t\t\tcontent: \"你好，我是彭于晏\",\r\n\t\t\t\t\ttime: \"2025-02-18T10:01:00\"\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\t\"3\": [ // 与用户3的聊天记录\r\n\t\t\t\t{\r\n\t\t\t\t\tsenderId: \"1\",\r\n\t\t\t\t\tcontent: \"嗨，最近怎么样？\",\r\n\t\t\t\t\ttime: \"2025-02-18T11:00:00\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t\"2\": { // 用户2的聊天记录\r\n\t\t\t\"1\": [ // 与用户1的聊天记录（与上面重复，但为了完整性保留）\r\n\t\t\t\t{\r\n\t\t\t\t\tsenderId: \"1\",\r\n\t\t\t\t\tcontent: \"你好！\",\r\n\t\t\t\t\ttime: \"2025-02-18T10:00:00\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tsenderId: \"2\",\r\n\t\t\t\t\tcontent: \"你好，我是朋友\",\r\n\t\t\t\t\ttime: \"2025-02-18T10:01:00\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t},\r\n\t\t\"3\": { // 用户3的聊天记录\r\n\t\t\t\"1\": [ // 与用户1的聊天记录\r\n\t\t\t\t{\r\n\t\t\t\t\tsenderId: \"1\",\r\n\t\t\t\t\tcontent: \"嗨，最近怎么样？\",\r\n\t\t\t\t\ttime: \"2025-02-18T11:00:00\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t}\r\n\t};\r\n\t\r\n\t// 临时数据——用户个人信息\r\n\tconst myInfo = reactive({\r\n\t\tavatar: '/static/pyy.jpeg',\r\n\t\tnickname: '未登录用户',\r\n\t\tuserID: '8',\r\n\t\tbirthday: ''\r\n\t});\r\n\t// 临时数据——朋友个人信息\r\n\tconst friendInfo = reactive({\r\n\t\tavatar: '',\r\n\t\tnickname: '',\r\n\t\tuserID: '',\r\n\t});\r\n\t// 消息列表\r\n\tconst messages = ref([]);\r\n\t// 在页面初始化时读取\r\n\tonLoad((options) => {\r\n\t\tconst stored = uni.getStorageSync('userInfo');\r\n\t\tif (stored) {\r\n\t\t\tObject.assign(myInfo, stored); // 保持响应式\r\n\t\t}\r\n\t\t// if (!options.friendId || !options.friendName || !options.friendAvatar) {\r\n\t\t//     console.error(\"缺少必要的参数\");\r\n\t\t//     return;\r\n\t\t// }\r\n\t\tfriendInfo.avatar = options.friendAvatar;\r\n\t\tfriendInfo.nickname = options.friendName;\r\n\t\tfriendInfo.userID = options.friendId;\r\n\t\tconst friendId = options.friendId;\r\n\t\tconst myId = myInfo.userID;\r\n\t\tfetchChatHistory(friendId, myId);\r\n\t});\r\n\t//获取聊天记录\r\n\tconst fetchChatHistory = async (friendId, myId) => {\r\n\t  try {\r\n\t    // 检查是否存在用户 myId 的聊天记录\r\n\t    if (chatRecords[myId] && chatRecords[myId][friendId]) {\r\n\t      // 获取与 friendId 的聊天记录\r\n\t      const chatHistory = chatRecords[myId][friendId];\r\n\t\r\n\t      // 转换为 messages 数组的格式\r\n\t      messages.value = chatHistory.map(message => ({\r\n\t\t\ttime:message.time,\r\n\t        content: message.content,\r\n\t        isSelf: message.senderId === myId // 如果 senderId 等于 myId，则 isSelf 为 true\r\n\t      }));\r\n\t\r\n\t      console.log(\"聊天记录转换成功:\", messages.value);\r\n\t    } else {\r\n\t      console.log(\"没有找到与该朋友的聊天记录\");\r\n\t      messages.value = []; // 如果没有找到聊天记录，清空 messages 数组\r\n\t    }\r\n\t  } catch (error) {\r\n\t    console.error(\"获取聊天记录失败:\", error);\r\n\t  }\r\n\t};\r\n\t// const fetchChatHistory = async (friendId, myId) => {\r\n\t//   try {\r\n\t//     // 模拟从后端获取数据\r\n\t//     const response = await fetch(`/api/chat/history?userId=${myId}&friendId=${friendId}`);\r\n\t//     const data = await response.json();\r\n\t//     messages.value = data; // 将后端返回的聊天记录赋值给 messages\r\n\t//     console.log(\"聊天记录获取成功:\", messages.value);\r\n\t//   } catch (error) {\r\n\t//     console.error(\"获取聊天记录失败:\", error);\r\n\t//   }\r\n\t// };\r\n\r\n\t// // 示例调用\r\n\t// fetchChatHistory(\"456\", \"123\");\r\n\tconst goBack = () => {\r\n\t\tuni.navigateBack()\r\n\t}\r\n\r\n\t// 输入框内容\r\n\tconst messageToSend = ref('');\r\n\r\n\tconst toggle = ref(false);\r\n\r\n\tfunction onComfirm() {\r\n\t\tmessages.value.push({\r\n\t\t\tcontent: messageToSend.value,\r\n\t\t\tisSelf: true\r\n\t\t})\r\n\t\tconsole.log(messages);\r\n\t\tmessageToSend.value = '';\r\n\t}\r\n\r\n\tfunction onFocus() {\r\n\t\ttoggle.value = true;\r\n\t}\r\n\r\n\tfunction onBlur() {\r\n\t\ttoggle.value = false;\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.chat-window {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\theight: 100vh;\r\n\t\tposition: relative;\r\n\r\n\t\t.header {\r\n\t\t\tposition: fixed;\r\n\t\t\ttop: 0;\r\n\t\t\tleft: 0;\r\n\t\t\tright: 0;\r\n\t\t\theight: 90rpx;\r\n\t\t\tbackground: #fff;\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tborder-bottom: 1px solid #eee;\r\n\t\t\tz-index: 2;\r\n\r\n\t\t\t/* 返回图标 */\r\n\t\t\t.back-icon {\r\n\t\t\t\tmargin-left: 30rpx;\r\n\t\t\t\t/* 距离左边界的距离 */\r\n\t\t\t}\r\n\r\n\t\t\t/* 好友名字 */\r\n\t\t\t.friend-name {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\t/* 占据剩余空间 */\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\t/* 文字居中 */\r\n\t\t\t\tfont-size: 34rpx;\r\n\t\t\t\tfont-weight: 500;\r\n\t\t\t\tcolor: #333;\r\n\t\t\t\tpadding-right: 60rpx;\r\n\t\t\t\t/* 避免文字被返回图标挤压 */\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.message-list {\r\n\t\t\tpadding-top: 200rpx;\r\n\t\t\t/* 为导航栏留出空间 */\r\n\t\t\tpadding-bottom: 60rpx;\r\n\t\t\t/* 为输入框留出空间 */\r\n\t\t\tflex: 1;\r\n\r\n\t\t\t.message-item {\r\n\t\t\t\tmargin: 20rpx;\r\n\t\t\t\tpadding: 10rpx 0;\r\n\r\n\t\t\t\t.message-friend {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tflex-direction: row;\r\n\r\n\t\t\t\t\t.avatar-friend {\r\n\t\t\t\t\t\twidth: 80rpx;\r\n\t\t\t\t\t\theight: 80rpx;\r\n\t\t\t\t\t\tborder-radius: 40rpx;\r\n\t\t\t\t\t\tmargin-left: 20rpx;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.message-content-friend-text {\r\n\t\t\t\t\t\tmax-width: 80%;\r\n\t\t\t\t\t\tpadding: 8rpx 16rpx;\r\n\t\t\t\t\t\tmargin-left: 25rpx;\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\tbackground-color: #fff;\r\n\t\t\t\t\t\tborder-radius: 30rpx;\r\n\t\t\t\t\t\tcolor: #000;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.message-self {\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tflex-direction: row-reverse;\r\n\r\n\t\t\t\t\t.avatar-self {\r\n\t\t\t\t\t\twidth: 80rpx;\r\n\t\t\t\t\t\theight: 80rpx;\r\n\t\t\t\t\t\tborder-radius: 40rpx;\r\n\t\t\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.message-content-self-text {\r\n\t\t\t\t\t\tmax-width: 80%;\r\n\t\t\t\t\t\tpadding: 8rpx 16rpx;\r\n\t\t\t\t\t\tmargin-right: 25rpx;\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\talign-items: center;\r\n\t\t\t\t\t\tjustify-content: center;\r\n\t\t\t\t\t\tbackground-color: #2d65f7;\r\n\t\t\t\t\t\tborder-radius: 30rpx;\r\n\t\t\t\t\t\tcolor: #fff;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.input-container {\r\n\t\t\tdisplay: flex;\r\n\t\t\talign-items: center;\r\n\t\t\tpadding: 20rpx 0;\r\n\t\t\tbackground: rgba(255, 255, 255, 0.8);\r\n\t\t\tpadding-bottom: 35rpx;\r\n\r\n\t\t\t.input-box {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\theight: 60rpx;\r\n\t\t\t\tpadding: 16rpx;\r\n\t\t\t\tpadding-bottom: 0rpx;\r\n\t\t\t\tborder: 2.5rpx solid black;\r\n\t\t\t\tborder-radius: 40rpx;\r\n\t\t\t\tmargin: 0 30rpx;\r\n\t\t\t\tbackground: rgba(255, 255, 255, 0.5);\r\n\t\t\t}\r\n\r\n\t\t\t.emoji,\r\n\t\t\t.more {\r\n\t\t\t\twidth: 50rpx;\r\n\t\t\t\theight: 50rpx;\r\n\t\t\t\tmargin-right: 20rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.send {\r\n\t\t\t\tmargin-right: 30rpx;\r\n\t\t\t\tbackground-color: aqua;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>","import MiniProgramPage from 'E:/program/FrontEnd/uni/uyub/pages/message/chat-window.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","reactive","ref","onLoad"],"mappings":"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"}