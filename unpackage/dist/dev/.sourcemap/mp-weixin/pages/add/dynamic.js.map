{"version":3,"file":"dynamic.js","sources":["pages/add/dynamic.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWRkL2R5bmFtaWMudnVl"],"sourcesContent":["<template>\n  <view class=\"page-container\">\n    <!-- 头部标题 -->\n    <view class=\"page-header\">\n      <text class=\"header-title\">发布动态</text>\n    </view>\n\n    <!-- 表单容器 -->\n    <view class=\"form-container\">\n      <!-- 标题输入 -->\n      <view class=\"form-item\">\n        <text class=\"item-label\">标题</text>\n        <input \n          type=\"text\" \n          v-model=\"post.title\" \n          class=\"input-field\"\n          placeholder=\"请输入吸引人的标题...\"\n          placeholder-class=\"placeholder-style\"\n        />\n      </view>\n\n      <!-- 内容输入 -->\n      <view class=\"form-item content-item\">\n        <text class=\"item-label\">内容</text>\r\n        <view class=\"textarea-container\">\n        <textarea \n          v-model=\"post.content\" \n          class=\"textarea-field\"\n          placeholder=\"分享你的精彩内容...\"\n          placeholder-class=\"placeholder-style\"\n          auto-height\n        />\r\n        </view>\n      </view>\n\n      <!-- 图片上传 -->\n      <view class=\"form-item\">\n        <text class=\"item-label\">图片</text>\n        <view class=\"upload-container\">\n          <view \n            v-for=\"(image, index) in images\" \n            :key=\"index\" \n            class=\"image-preview\"\n          >\n            <image :src=\"image\" class=\"preview-image\" mode=\"aspectFill\" />\n            <view class=\"delete-icon\" @click=\"removeImage(index)\">×</view>\n          </view>\n          <view \n            class=\"upload-btn\" \n            @click=\"chooseImage\"\n            v-if=\"images.length < 9\"\n          >\n            <text class=\"plus-icon\">+</text>\n            <text class=\"upload-text\">添加图片</text>\n          </view>\n        </view>\n        <text class=\"upload-tip\">最多可上传9张图片</text>\n      </view>\n</view>\n    <!-- 发布按钮 -->\n    <view class=\"submit-btn\" @click=\"publishPost\">\n      <text class=\"btn-text\">{{ userInfo.phone ? '立即发布' : '请先登录' }}</text>\n    </view>\n  </view>\r\n  <br>\r\n  <br>\n</template>\n\n<script setup>\nimport { ref, reactive} from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\n\nconst images = ref([]);\nconst isSubmitting = ref(false);\nconst post = reactive({\n  title: '',\n  content: '',\n});\n\nconst selectedCategoryIndex = ref(null);\n\nconst chooseImage = () => {\n  const remaining = 9 - images.value.length;\n  uni.chooseImage({\n    count: remaining,\n    sizeType: ['compressed'],\n    sourceType: ['album'],\n    success: (res) => {\n      images.value.push(...res.tempFilePaths);\n    }\n  });\n};\n\nconst removeImage = (index) => {\n  images.value.splice(index, 1);\n};\n\nconst categoryChange = (e) => {\n  selectedCategoryIndex.value = e.detail.value;\n};\r\n// 用户信息\nconst userInfo = reactive({\n  avatar: '/static/dinohead.png',\n  nickname: '未登录用户',\n  phone: '1',\n  birthday: ''\n});\n// 在页面初始化时读取\nonLoad(() => {\n  const stored = uni.getStorageSync('userInfo');\n  if (stored) {\n    Object.assign(userInfo, stored); // 保持响应式\n  }\n});\n\nconst publishPost = async () => {\r\n  if(userInfo.phone==''){\r\n    uni.showToast({\r\n      title: '请先登录',\r\n      icon: 'none'\r\n    });\r\n    return;\r\n  }\n  if (isSubmitting.value) return;\n\n  if (!post.title.trim()) {\n    uni.showToast({ title: '请填写标题', icon: 'none' });\n    return;\n  }\n\n  if (!post.content.trim()) {\n    uni.showToast({ title: '请填写内容', icon: 'none' });\n    return;\n  }\n  isSubmitting.value = true;\n\n  try {\r\n    console.log(images.value.join(','));\n    const res = await uni.request({\n      method: 'post',\n      url: '/fatie',\n      data: JSON.stringify({\r\n        ...post,\r\n        images: images.value.join(','),\r\n        phone:userInfo.phone\r\n      }\r\n    )});\n    \n    uni.showToast({ title: '发布成功', icon: 'success' });\n    setTimeout(() => uni.navigateBack(), 1500);\n  } catch (error) {\n    console.error('发布失败:', error);\n  } finally {\n    isSubmitting.value = false;\n  }\n};\n</script>\n<style lang=\"scss\" scoped>\n.page-container {\n  padding: 20rpx 30rpx;\n  background: #f8f9fa;\n  min-height: 100vh;\n}\n\n.page-header {\n  padding: 40rpx 0;\n  .header-title {\n    font-size: 36rpx;\n    font-weight: bold;\n    color: #333;\n  }\n}\n\n.form-container {\n  background: white;\n  border-radius: 16rpx;\n  padding: 30rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0,0,0,0.05);\n}\n\n.form-item {\n  margin-bottom: 40rpx;\n  .item-label {\n    display: block;\n    font-size: 30rpx;\n    color: #333;\n    margin-bottom: 20rpx;\n    font-weight: 500;\n  }\n}\n\n.input-field, .textarea-field {\n  padding: 20rpx;\n  border: 2rpx solid #e9ecef;\n  border-radius: 8rpx;\n  font-size: 28rpx;\n  color: #333;\r\n  width: 95%;\n}\n\n.placeholder-style {\n  color: #adb5bd;\n  font-size: 28rpx;\n}\n\n.upload-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10rpx;\n}\n\n.image-preview {\n  width: 200rpx;\n  height: 200rpx;\n  border-radius: 8rpx;\n  overflow: hidden;\n  position: relative;\n  .preview-image {\n    width: 100%;\n    height: 100%;\n  }\n  .delete-icon {\n    position: absolute;\n    right: 10rpx;\n    top: 10rpx;\n    width: 36rpx;\n    height: 36rpx;\n    background: rgba(0,0,0,0.5);\n    color: white;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 24rpx;\n  }\n}\n\n.upload-btn {\n  width: 200rpx;\n  height: 200rpx;\n  border: 2rpx dashed #e9ecef;\n  border-radius: 8rpx;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  .plus-icon {\n    font-size: 48rpx;\n    color: #666;\n  }\n  .upload-text {\n    font-size: 24rpx;\n    color: #666;\n    margin-top: 10rpx;\n  }\n}\n\n.upload-tip {\n  font-size: 24rpx;\n  color: #999;\n  display: block;\n  margin-top: 20rpx;\n}\n\n.category-picker {\n  .picker-content {\n    padding: 20rpx;\n    border: 2rpx solid #e9ecef;\n    border-radius: 8rpx;\n    font-size: 28rpx;\n    color: #333;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    .arrow-icon {\n      color: #666;\n      font-size: 24rpx;\n      margin-left: 20rpx;\n    }\n  }\n}\n\n.submit-btn {\n  margin: 40rpx 0;\n  background: #007aff;\n  border-radius: 50rpx;\n  padding: 25rpx 0;\n  text-align: center;\r\n  position: fixed;\r\n  width: 80%;\r\n  bottom: 0;\r\n  left: 10%;\r\n  box-shadow: 0 0 10rpx rgba(0, 0, 0, 0.1);\r\n  z-index: 9;\n  .btn-text {\n    color: white;\n    font-size: 32rpx;\n    font-weight: 500;\n  }\n  &:active {\n    opacity: 0.9;\n  }\n}\n</style>","import MiniProgramPage from 'E:/program/FrontEnd/uni/uyub/pages/add/dynamic.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","uni","onLoad"],"mappings":";;;;;AAwEA,UAAM,SAASA,cAAAA,IAAI,CAAA,CAAE;AACrB,UAAM,eAAeA,cAAAA,IAAI,KAAK;AAC9B,UAAM,OAAOC,cAAAA,SAAS;AAAA,MACpB,OAAO;AAAA,MACP,SAAS;AAAA,IACX,CAAC;AAE6BD,kBAAG,IAAC,IAAI;AAEtC,UAAM,cAAc,MAAM;AACxB,YAAM,YAAY,IAAI,OAAO,MAAM;AACnCE,oBAAAA,MAAI,YAAY;AAAA,QACd,OAAO;AAAA,QACP,UAAU,CAAC,YAAY;AAAA,QACvB,YAAY,CAAC,OAAO;AAAA,QACpB,SAAS,CAAC,QAAQ;AAChB,iBAAO,MAAM,KAAK,GAAG,IAAI,aAAa;AAAA,QACvC;AAAA,MACL,CAAG;AAAA,IACH;AAEA,UAAM,cAAc,CAAC,UAAU;AAC7B,aAAO,MAAM,OAAO,OAAO,CAAC;AAAA,IAC9B;AAMA,UAAM,WAAWD,cAAAA,SAAS;AAAA,MACxB,QAAQ;AAAA,MACR,UAAU;AAAA,MACV,OAAO;AAAA,MACP,UAAU;AAAA,IACZ,CAAC;AAEDE,kBAAAA,OAAO,MAAM;AACX,YAAM,SAASD,cAAAA,MAAI,eAAe,UAAU;AAC5C,UAAI,QAAQ;AACV,eAAO,OAAO,UAAU,MAAM;AAAA,MAC/B;AAAA,IACH,CAAC;AAED,UAAM,cAAc,YAAY;AAC9B,UAAG,SAAS,SAAO,IAAG;AACpBA,sBAAAA,MAAI,UAAU;AAAA,UACZ,OAAO;AAAA,UACP,MAAM;AAAA,QACZ,CAAK;AACD;AAAA,MACD;AACD,UAAI,aAAa;AAAO;AAExB,UAAI,CAAC,KAAK,MAAM,QAAQ;AACtBA,sBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,OAAM,CAAE;AAC9C;AAAA,MACD;AAED,UAAI,CAAC,KAAK,QAAQ,QAAQ;AACxBA,sBAAG,MAAC,UAAU,EAAE,OAAO,SAAS,MAAM,OAAM,CAAE;AAC9C;AAAA,MACD;AACD,mBAAa,QAAQ;AAErB,UAAI;AACFA,4BAAY,MAAA,OAAA,gCAAA,OAAO,MAAM,KAAK,GAAG,CAAC;AAClC,cAAM,MAAM,MAAMA,cAAG,MAAC,QAAQ;AAAA,UAC5B,QAAQ;AAAA,UACR,KAAK;AAAA,UACL,MAAM,KAAK;AAAA,YAAU;AAAA,cACnB,GAAG;AAAA,cACH,QAAQ,OAAO,MAAM,KAAK,GAAG;AAAA,cAC7B,OAAM,SAAS;AAAA,YAChB;AAAA,UACF;AAAA,QAAA,CAAC;AAEFA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,UAAS,CAAE;AAChD,mBAAW,MAAMA,cAAG,MAAC,aAAc,GAAE,IAAI;AAAA,MAC1C,SAAQ,OAAO;AACdA,2EAAc,SAAS,KAAK;AAAA,MAChC,UAAY;AACR,qBAAa,QAAQ;AAAA,MACtB;AAAA,IACH;;;;;;;;;;;;;;;;;;;;;;;;;AC1JA,GAAG,WAAW,eAAe;"}