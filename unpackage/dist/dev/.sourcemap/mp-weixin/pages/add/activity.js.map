{"version":3,"file":"activity.js","sources":["pages/add/activity.vue","D:/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvYWRkL2FjdGl2aXR5LnZ1ZQ"],"sourcesContent":["<template>\n  <view class=\"page-container\">\n    <!-- 头部标题 -->\n    <view class=\"page-header\">\n      <text class=\"header-title\">发布活动</text>\n    </view>\n\n    <!-- 表单容器 -->\n    <view class=\"form-container\">\n      <!-- 活动标题 -->\n      <view class=\"form-item\">\n        <text class=\"item-label\">活动标题</text>\n        <input v-model=\"activity.title\" class=\"input-field\" placeholder=\"请输入活动名称\" />\n      </view>\n\n      <!-- 活动费用 -->\n      <view class=\"form-item\">\n        <text class=\"item-label\">活动费用（元）</text>\n        <input v-model=\"activity.price\" class=\"input-field\" placeholder=\"请输入人均费用\" type=\"number\" />\n      </view>\n\n      <!-- 地址选择 -->\n      <view class=\"form-item address-group\">\n        <view class=\"address-item\">\n          <text class=\"item-label\">所在场馆</text>\n          <input v-model=\"activity.address\" class=\"input-field\" placeholder=\"场馆名称\" />\n        </view>\n        <view class=\"address-item\">\n          <text class=\"item-label\">详细地址</text>\n          <view class=\"input-field city-picker\">\r\n            <uni-icons type=\"location\"></uni-icons>\r\n            <picker mode=\"region\" @change=\"onRegionChange\" level=\"city\" style=\"width: 90%;\">&ensp;{{city}}</picker>\r\n          </view>\n          <input v-model=\"activity.detailAddress\" class=\"input-field\" placeholder=\"街道/参照地标等信息\" @input=\"onAddressChange\" />\n        </view>\n      </view>\n\n      <!-- 时间选择 -->\n      <view class=\"form-item time-picker\">\n        <text class=\"item-label\">活动时间</text>\n        <!-- 日期选择 -->\n        <view class=\"date-picker\">\n          <uni-datetime-picker type=\"date\" v-model=\"activity.date\" @change=\"setDate\" />\n        </view>\n        <view class=\"time-container\">\n          <picker mode=\"time\" @change=\"setStartTime\" class=\"time-item\">\n            <view class=\"picker-content\">\n              {{ activity.startTime || '开始时间' }}\n            </view>\n          </picker>\n          <text class=\"time-separator\">-</text>\n          <picker mode=\"time\" @change=\"setEndTime\" class=\"time-item\">\n            <view class=\"picker-content\">\n              {{ activity.endTime || '结束时间' }}\n            </view>\n          </picker>\n        </view>\n      </view>\n\n      <!-- 人数设置 -->\n      <view class=\"form-item number-group\">\n        <view class=\"number-item\">\n          <text class=\"item-label\">计划人数</text>\n          <input v-model=\"activity.plan\" class=\"input-field\" type=\"number\" placeholder=\"总招募人数\" />\n        </view>\n      </view>\n\n      <!-- 活动标签 -->\n      <view class=\"form-item\">\n        <text class=\"item-label\">活动类型</text>\n        <picker mode=\"selector\" :range=\"Options\" @change=\"setOption\" class=\"tag-picker\">\n          <view class=\"picker-content\">\n            {{ activity.option || '选择活动类型' }}\n          </view>\n        </picker>\n      </view>\n      <view class=\"form-item\">\n        <text class=\"item-label\">活动水平</text>\n        <picker mode=\"selector\" :range=\"Tags\" @change=\"setTag\" class=\"tag-picker\">\n          <view class=\"picker-content\">\n            {{ activity.tag || '选择活动水平' }}\n          </view>\n        </picker>\n      </view>\n\n      <!-- 活动详情 -->\n      <view class=\"form-item\">\n        <text class=\"item-label\">活动详情</text>\n        <textarea v-model=\"activity.description\" class=\"textarea-field\" placeholder=\"请输入活动详细说明...\" auto-height />\n      </view>\n\n      <!-- 图片上传 -->\n      <view class=\"form-item\">\n        <text class=\"item-label\">活动图片</text>\n        <view class=\"upload-container\">\n          <view v-for=\"(image, index) in images\" :key=\"index\" class=\"image-preview\">\n            <image :src=\"image\" class=\"preview-image\" mode=\"aspectFill\" />\n            <view class=\"delete-icon\" @click=\"removeImage(index)\">×</view>\n          </view>\n          <view class=\"upload-btn\" @click=\"chooseImage\" v-if=\"images.length < 9\">\n            <text class=\"plus-icon\">+</text>\n            <text class=\"upload-text\">添加图片</text>\n          </view>\n        </view>\n        <text class=\"upload-tip\">建议上传活动场地实拍图（最多9张）</text>\n      </view>\n    </view>\n\n    <!-- 发布按钮 -->\n    <view class=\"submit-btn\" @click=\"publishActivity\">\n      <text class=\"btn-text\">{{ userInfo.phone ? '立即发布' : '请先登录' }}</text>\n    </view>\n  </view>\n</template>\n\n<script setup>\nimport { ref, reactive } from 'vue';\nimport { onLoad } from '@dcloudio/uni-app';\n\n// 定义常量\nconst Options = ['羽毛球', '游戏', '乒乓球', '其他'];\nconst Tags = ['不限', '萌新', '中级', '高级'];\n\n// 定义响应式状态\nconst images = ref([]);\nconst activity = reactive({\n  title: '',\n  price: '',\n  address: '',\n  detailAddress: '',\n  date: '',\n  startTime: '',\n  endTime: '',\n  plan: '',\n  tag: '',\n  option: '',\n  description: '',\n  images: []\n});\n\n// 选图\nconst chooseImage = () => {\n  uni.chooseImage({\n    count: 9 - images.value.length,\n    sizeType: ['compressed'],\n    sourceType: ['album'],\n    success: (res) => {\n      images.value = [...images.value, ...res.tempFilePaths];\n    }\n  });\n};\n\nconst removeImage = (index) => {\n  images.value.splice(index, 1);\n};\n\nconst setDate = (e) => {\n  activity.date = e;\n};\n\nconst setStartTime = (e) => {\n  activity.startTime = e.detail.value;\n  validateTime();\n};\n\nconst setEndTime = (e) => {\n  activity.endTime = e.detail.value;\n  validateTime();\n};\n\nconst setTag = (e) => {\n  activity.tag = Tags[e.detail.value];\n};\nconst city=ref('不限')\r\n\r\nconst onRegionChange = (e) => {\r\n  city.value = e.detail.value[1];\r\n};\r\nconst onAddressChange = (e) => {\r\n  activity.detailAddress = city.value+e.detail.value;\r\n};\nconst validateTime = () => {\n  if (activity.startTime && activity.endTime) {\n    const start = new Date(`1970-01-01T${activity.startTime}`);\n    const end = new Date(`1970-01-01T${activity.endTime}`);\n    if (start >= end) {\n      uni.showToast({\n        title: '结束时间必须晚于开始时间',\n        icon: 'none'\n      });\n      activity.endTime = '';\n    }\n  }\n};\n\nconst setOption = (e) => {\n  activity.option = Options[e.detail.value];\n};\n\nconst isSubmitting = ref(false);\n\nconst publishActivity = async () => {\n  if (userInfo.phone === '') {\n    uni.showToast({\n      title: '请先登录',\n      icon: 'none'\n    });\n    return;\n  }\n  if (isSubmitting.value) return;\n\n  // 表单验证\n  const requiredFields = [\n    { field: 'title', message: '请填写活动标题' },\n    { field: 'price', message: '请填写活动费用' },\n    { field: 'address', message: '请选择所在场馆' },\n    { field: 'date', message: '请选择日期' },\n    { field: 'startTime', message: '请选择开始时间' },\n    { field: 'endTime', message: '请选择结束时间' },\n    { field: 'plan', message: '请填写计划人数' }\n  ];\n\n  for (const { field, message } of requiredFields) {\n    if (!activity[field]) {\n      return uni.showToast({\n        title: message,\n        icon: 'none'\n      });\n    }\n  }\n\n  try {\n    // 1. 先上传图片\n    const imageUrls = await uploadImages();\n\n    // 2. 提交活动数据\n    const res = await uni.request({\n      method: 'POST',\n      url: '/activities',\n      data: {\n        ...activity,\n        images: imageUrls\n      }\n    });\n\n    // 处理响应...\n  } catch (error) {\n    uni.showToast({\n      title: error.message || '发布失败',\n      icon: 'none'\n    });\n  } finally {\n    isSubmitting.value = false;\n  }\n};\n\n// 用户信息\nconst userInfo = reactive({\n  avatar: '/static/dinohead.png',\n  nickname: '未登录用户',\n  phone: '1',\n  birthday: ''\n});\n\n// 在页面初始化时读取\nonLoad(() => {\n  const stored = uni.getStorageSync('userInfo');\n  if (stored) {\n    Object.assign(userInfo, stored);\n  }\n});\n</script>\n\n<style lang=\"scss\" scoped>\n.page-container {\n  padding: 20rpx 30rpx;\n  background: #f8f9fa;\n  min-height: 100vh;\n}\n\n.page-header {\n  padding: 40rpx 0;\n\n  .header-title {\n    font-size: 36rpx;\n    font-weight: bold;\n    color: #333;\n  }\n}\n\n.form-container {\n  background: white;\n  border-radius: 16rpx;\n  padding: 30rpx;\n  box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);\n}\n\n.form-item {\n  margin-bottom: 40rpx;\n\n  .item-label {\n    display: block;\n    font-size: 30rpx;\n    color: #333;\n    margin-bottom: 20rpx;\n    font-weight: 500;\n  }\n}\n\n.input-field,\n.textarea-field {\n  padding: 20rpx;\n  border: 2rpx solid #e9ecef;\n  border-radius: 8rpx;\n  font-size: 28rpx;\n  color: #333;\n}\n\n.upload-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 20rpx;\n}\n\n.image-preview {\n  width: 200rpx;\n  height: 200rpx;\n  border-radius: 8rpx;\n  overflow: hidden;\n  position: relative;\n\n  .preview-image {\n    width: 100%;\n    height: 100%;\n  }\n\n  .delete-icon {\n    position: absolute;\n    right: 10rpx;\n    top: 10rpx;\n    width: 36rpx;\n    height: 36rpx;\n    background: rgba(0, 0, 0, 0.5);\n    color: white;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 24rpx;\n  }\n}\n\n.upload-btn {\n  width: 200rpx;\n  height: 200rpx;\n  border: 2rpx dashed #e9ecef;\n  border-radius: 8rpx;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n\n  .plus-icon {\n    font-size: 48rpx;\n    color: #666;\n  }\n\n  .upload-text {\n    font-size: 24rpx;\n    color: #666;\n    margin-top: 10rpx;\n  }\n}\n\n.upload-tip {\n  font-size: 24rpx;\n  color: #999;\n  display: block;\n  margin-top: 20rpx;\n}\n\n.submit-btn {\n  margin: 40rpx 0;\n  background: #007aff;\n  border-radius: 50rpx;\n  padding: 25rpx 0;\n  text-align: center;\n  position: fixed;\n  width: 80%;\n  bottom: 0;\n  left: 10%;\n  box-shadow: 0 0 10rpx rgba(0, 0, 0, 0.1);\n  z-index: 9;\n\n  .btn-text {\n    color: white;\n    font-size: 32rpx;\n    font-weight: 500;\n  }\n\n  &:active {\n    opacity: 0.9;\n  }\n}\n\n.address-group {\n  .address-item {\n    margin-bottom: 30rpx;\n\n    &:last-child {\n      margin-bottom: 0;\n    }\n  }\n}\n.city-picker{\r\n  display: flex;\r\n}\n.time-picker {\n  .date-picker {\n    margin-bottom: 30rpx;\n  }\n\n  .time-container {\n    display: flex;\n    align-items: center;\n    gap: 20rpx;\n\n    .time-item {\n      flex: 1;\n\n      .picker-content {\n        padding: 10rpx;\n        border: 2rpx solid #e9ecef;\n        border-radius: 8rpx;\n        text-align: center;\n        color: #333;\n      }\n    }\n\n    .time-separator {\n      color: #666;\n      font-size: 28rpx;\n    }\n  }\n}\n\n.number-group {\n  display: flex;\n  gap: 30rpx;\n\n  .number-item {\n    flex: 1;\n  }\n}\n\n.tag-picker {\n  .picker-content {\n    padding: 20rpx;\n    border: 2rpx solid #e9ecef;\n    border-radius: 8rpx;\n    color: #333;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n  }\n}\n\n.textarea-field {\n  min-height: 200rpx;\n  padding: 20rpx;\n  line-height: 1.6;\n}\n</style>","import MiniProgramPage from 'E:/program/FrontEnd/uni/uyub/pages/add/activity.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","reactive","uni","onLoad"],"mappings":"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"}